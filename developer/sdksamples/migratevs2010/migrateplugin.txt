====== Migrating Rhino 5.0 Plug-ins from Visual Studio 2005 to Visual Studio 2010 ======

===== Before you Start: =====
  - Purchase and install [[http://www.microsoft.com/visualstudio/en-us/products/2010-editions/professional|Microsoft Visual Studio 2010 Professional with MSDN]]. ([[developer:sdksamples:migratevs2010:vs2010pro|Why Pro with MSDN?]])
  - [[http://download.rhino3d.com/rhino/5.0/beta/rc/download|Download the Rhino 5.0 64-bit (VS2010 Transition Build)]]
  - [[http://download.rhino3d.com/rhino-sdk/5.0/wip/download|Install the Rhino 5.0 64-bit SDK]]

===== Migrating your Plug-ins: =====
  - **Delete all .SLN files** associated with the project you are converting. You can also change the extension if you are not using version control. Failure to do so will cause the Visual Studio 2010 project migration wizard to migrate all the projects in your solution (this may be what you need to do, but converting them individually and creating a new solution seems to work better).
  - **Open Visual Studio 2010**
  - From the **File** menu, click **Open**, then click **Project/Solution**.
  - Browse to your plug-in .vcproj file, and click **Open**.
  - Click **Next**
  - Select the **Yes, create a backup before converting** radio button.
  - Click **Next**
  - Click **Finish**
  - Select the **Show the conversion log when the wizard is closed** checkbox.
  - Review the log and conversion report.

At this point, the project is converted, but you need to make some changes to get the project to compile properly in both 32- and 64-bit configurations.

===== Understanding the Conversion Warnings: =====
You will likely get some warnings during conversion. Here are the ones we saw and how to deal with them:

==== Warnings you can safely ignore: ====
  * **Web deployment to the local IIS server is no longer supported** - This is irrelevant for Rhino plug-ins.
  * **This application has been updated to include settings related to the User Account Control (UAC) feature of Windows Vista.** - Rhino 5.0 handles UAC for you. If your plug-in worked in older builds of 5.0, it will continue to work. Should you have questions about UAC, please contact developer support.
  * **VCWebServiceProxyGeneratorTool is no longer supported** -- This is irrelevant for Rhino plug-ins.
  * **Attribute 'Detect64BitPortabilityProblems' of 'VCCLCompilerTool' is not supported in this version and has been removed during conversion.** - These warnings now happen by default in VS2010.

==== Warnings you should fix: ====
The following three warnings are fixed using the steps below:
  * MSB8012: $(TargetName) ('plugin_name') does not match the Linker's OutputFile property value 'Configuration\plugin_name.rhp' in project configuration 'Configuration|Platform'...
  * MSB8012: $(TargetExt) ('.dll') does not match the Linker's OutputFile property value 'Configuration\plugin_name.rhp'
  * MSP8012: $(TargetPath) ('C:\full\path\to\plugin_name.dll') does not match the Linker's OutputFile property value 'Configuration\plugin_name.rhp'.

** Target Extension (All Configurations) **
  - In **Solution Explorer**, Right-click your project, then click **Properties**
  - From the **Configuration** drop-down, select **All Configurations**
  - From the **Platform** drop-down, select **All Platforms**.
  - In the tree on the left, select **Configuration Properties** -> **General**
  - Change **Target Extension** to **.rhp**
  - Click **Apply**

** Target Name (Debug) **
  - From the **Configuration** drop-down, select **Debug**
  - From the **Platform** drop-down, select **All Platforms**.
  - In the tree on the left, select **Configuration Properties** -> **General**
  - Change **Target Name** to **$(ProjectName)_d**
  - Click **Apply**

**  Output Directory and Intermediate Directory **
  - From the **Configuration** drop-down, select **All Configurations**
  - From the **Platform** drop-down, select **All Platforms**.
  - In the tree on the left, select **Configuration Properties** -> **General**
  - Change **Output Directory** to **$(Platform)\$(Configuration)\**
  - Change **Intermediate Directory** to **$(Platform)\$(Configuration)\**
  - Click **Apply**

** Linker Output File **
  - From the **Configuration** drop-down, select **All Configurations**
  - From the **Platform** drop-down, select **All Platforms**.
  - In the tree on the left, select **Configuration Properties** -> **Linker** -> **General**
  - Change **Output File** to **<inherit from parent or project defaults>**
  - Click **Apply**

===== Using Visual Studio 2005 for 32-bit Builds (REQUIRED): =====
This step is required.

** Output Directory and Intermediate Directory (Win32) **
  - From the **Configuration** drop-down, select **All Configurations**
  - From the **Platform** drop-down, select **Win32**.
  - In the tree on the left, select **Configuration Properties** -> **General**
  - Change **Platform Toolset** to **v80**
  - Click **Apply**

===== Replace new header files in stdafx.h =====
  * In your plug-in project, open **stdafx.h**
  * Change
    * #include "C:\Program Files\Rhino 5.0 SDK/Inc/RhinoSdkStdafxPreamble.h"
    * to
    * #include "C:/Program Files (x86)/Rhino 5.0 x64 SDK/inc/RhinoSdkStdafxPreamble.h"
  * Change
    * #include "C:\Program Files\Rhino 5.0 SDK/Inc/RhinoSdk.h"
    * to
    * #include "C:/Program Files (x86)/Rhino 5.0 x64 SDK/inc/RhinoSdk.h"

  * Change 
    * #include "C:\Program Files\Rhino 5.0 SDK/Inc/rhinoSdkPlugInLinkingPragmas.h"
    * to
    * #include "C:/Program Files (x86)/Rhino 5.0 x64 SDK/inc/rhinoSdkPlugInLinkingPragmas.h"

===== Test Your Build =====
During compile of stdafx.cpp, you should see messages alerting you to the platform, configuration, and compiler used to build that version of your plug-in.

**For 32-bit builds, you should see:**
  * --- rhinoSDK.h --- Building (Configuration) Rhino V5 plug-in.
  * --- rhinoSDK.h --- Using Visual Studio 2010 compiler tools.
  * --- rhinoSDK.h --- Using v80 Windows Platform SDK (MFC 8.0, VC 2005).

**For 64-bit builds, you should see:**
  * --- rhinoSDK.h --- Building (Configuration) Rhino V5 plug-in.
  * --- rhinoSDK.h --- Using Visual Studio 2010 compiler tools.
  * --- rhinoSDK.h --- Using v100 Windows Platform SDK (MFC 10.0, VC 2010).

If you don't, you didn't follow the steps above properly.

{{tag>Developer cplusplus vs2010}}